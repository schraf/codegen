# Codegen

A simple, template-based code generation tool written in Go. It uses Go's built-in `html/template` package to generate any kind of text-based file from JSON data sources.

## How it Works

The tool is driven by a `project.json` file (or any other name passed as an argument) that defines the code generation tasks. This file specifies:

-   **Includes:** A list of reusable, shared template files.
-   **Outputs:** A list of files to generate, each with its own main template, input data file, and output path.

## Usage

1.  Create a `project.json` file to define your code generation tasks.
2.  Run the tool, passing the project file as an argument.

```bash
go run ./cmd/main.go project.json
```

## The `project.json` Format

The project file has two main sections: `includes` and `outputs`.

-   `includes`: An array of strings, where each string is a path to a template file that can be included and reused in other templates. These are parsed first.
-   `outputs`: An array of objects, where each object defines a file to be generated.

### Output Object Structure

Each object in the `outputs` array has the following properties:

-   `template`: The path to the main template file for this output.
-   `input`: The path to the JSON file containing the data to be used in the template.
-   `output`: The path where the generated file will be saved.

### Example `project.json`

```json
{
  "includes": [
    "templates/helpers.tmpl"
  ],
  "outputs": [
    {
      "template": "templates/service.go.tmpl",
      "input": "data/user_service.json",
      "output": "gen/user_service.go"
    }
  ]
}
```

## Example

Let's say you want to generate a simple Go struct.

### 1. Project File

**`project.json`**
```json
{
  "includes": [],
  "outputs": [
    {
      "template": "struct.tmpl",
      "input": "struct_data.json",
      "output": "person.go"
    }
  ]
}
```

### 2. Input Data

**`struct_data.json`**
```json
{
  "PackageName": "main",
  "StructName": "Person",
  "Fields": [
    { "Name": "Name", "Type": "string" },
    { "Name": "Age", "Type": "int" }
  ]
}
```

### 3. Template File

**`struct.tmpl`**
```go-template
// Code generated by codegen. DO NOT EDIT.
package {{.PackageName}}

type {{.StructName}} struct {
{{- range .Fields}}
    {{.Name}} {{.Type}}
{{- end}}
}
```

### 4. Run the tool

```bash
go run ./cmd/main.go project.json
```

### 5. Generated Output

**`person.go`**
```go
// Code generated by codegen. DO NOT EDIT.
package main

type Person struct {
    Name string
    Age int
}
```

## Building from Source

### Prerequisites

-   [Go](https://golang.org/doc/install) (version 1.24 or later)

### Build Command

To build the executable, run:
```bash
go build -o codegen ./cmd/main.go
```
You can then run the tool directly: `./codegen project.json`.

### Makefile

A `Makefile` is provided with common targets:

-   `make build`: Build the project.
-   `make test`: Run tests.
-   `make vet`: Vet the Go source code for issues.
-   `make fmt`: Format the Go source code.
-   `make all`: Run `deps`, `vet`, and `test`.
